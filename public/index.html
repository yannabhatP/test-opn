<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Out With Promptpay</title>
    <script 
        type="text/javascript" 
        src="https://cdn.omise.co/omise.js"
    >
    </script>
</head>
<body>
    <form id="checkoutForm"  >
        <input type="hidden" name="omiseToken">
        <input type="hidden" name="omiseSource">
        <button type="submit" id="checkoutButton">Checkout</button>
      </form>
      <a id="qrcode" download>
        <img id="qrcode-img">
      </a>
      
      
      <script>
        Omise.setPublicKey("PUBLIC OPN KEY");
      
        var button = document.querySelector("#checkoutButton");
        var form = document.querySelector("#checkoutForm");
      
        button.addEventListener("click", (event) => {
          event.preventDefault();
          Omise.createSource(
            "promptpay",
            {
                "amount" : 10000,
                "currency" : "THB"
            },
            async(statusCode, response)=>{
                const data  = await fetch("http://localhost:3000/promptpay/"+response.id)
                .then( res => res.json())
                .then( res => res?.source?.scannable_code?.image?.download_uri)
                .catch(err => console.error(err))

                var link = document.querySelector("#qrcode")
                var img = document.querySelector("#qrcode-img")
                link.setAttribute("href",data)
                img.setAttribute("src",data)
                
            }
          )
        });
      </script>
</body>
</html>